–∫—Ä–∞—Å–∞–≤–∞, –∫–æ–¥ –≤ —Ü–µ–ª–æ–º –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π, –ª–æ–≥–∏–∫–∞ –Ω–æ—Ä–º, UI –∂–∏—Ä–Ω—ã–π üëç
–Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö Render –ª–∏–±–æ —É–ø–∞–¥—ë—Ç, –ª–∏–±–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫—Ä–∏–≤–æ. –ù–∏–∂–µ ‚Äî —á—ë—Ç–∫–∏–π —Ä–∞–∑–±–æ—Ä + —Ç–æ—á–µ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏, –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ.

‚ùó 1. –°–ê–ú–ê–Ø –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê ‚Äî node-fetch
‚ùå –°–µ–π—á–∞—Å —É —Ç–µ–±—è
const fetch = require('node-fetch');
‚ùó –ü—Ä–æ–±–ª–µ–º–∞

node-fetch@3 –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç —Å require

–Ω–∞ Render —ç—Ç–æ = –∫—Ä–∞—à –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

‚úÖ –í–ê–†–ò–ê–ù–¢ 1 (–†–ï–ö–û–ú–ï–ù–î–£–Æ) ‚Äî –≤–æ–æ–±—â–µ —É–±—Ä–∞—Ç—å node-fetch

Node 18+ (–∞ Render –¥–∞—ë—Ç 18) –£–ñ–ï –ò–ú–ï–ï–¢ fetch

‚úîÔ∏è –ü—Ä–æ—Å—Ç–æ –£–î–ê–õ–ò —Å—Ç—Ä–æ–∫—É:
const fetch = require('node-fetch');

–∏ –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –º–µ–Ω—è–π ‚Äî fetch() –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å üî•

‚ùå –ù–ï –ù–ê–î–û

–Ω–µ —Å—Ç–∞–≤—å node-fetch@2

–Ω–µ –º–µ—à–∞–π require –∏ import

‚ùó 2. OpenAI API ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å:

openai.chat.completions.create

‚ö†Ô∏è –≠—Ç–æ legacy, –ø–æ–∫–∞ –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–µ—Ç –æ—Ç–≤–∞–ª–∏—Ç—å—Å—è.

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –î–õ–Ø openai@4+ (–∏ –¥–µ—à–µ–≤–ª–µ)
üîÅ –ó–∞–º–µ–Ω–∏ –í–ï–°–¨ –±–ª–æ–∫ OpenAI-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —ç—Ç–æ:
const response = await openai.responses.create({
  model: "o4-mini",
  input: prompt
});

const text = response.output[0].content[0].text;
const prediction = JSON.parse(text);

‚ùó –ò —É–¥–∞–ª–∏:

messages: [...]
max_tokens
temperature

o4-mini —Å–∞–º —Ö–æ–ª–æ–¥–Ω—ã–π, –µ–º—É –Ω–µ –Ω—É–∂–µ–Ω temperature.

‚ùó 3. express.static(path.join(__dirname)) ‚Äî –ø–ª–æ—Ö–∞—è –∏–¥–µ—è
‚ùå –°–µ–π—á–∞—Å
app.use(express.static(path.join(__dirname)));

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

—Å–µ—Ä–≤–µ—Ä —Ä–∞–∑–¥–∞—ë—Ç –≤—Å—ë –ø–æ–¥—Ä—è–¥

.env, server.js ‚Äî –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
üìÅ –°–¥–µ–ª–∞–π –ø–∞–ø–∫—É public/
public/
 ‚îú‚îÄ‚îÄ index.html
 ‚îú‚îÄ‚îÄ script.js
 ‚îî‚îÄ‚îÄ styles.css
‚úîÔ∏è –ò –∑–∞–º–µ–Ω–∏ middleware:
app.use(express.static(path.join(__dirname, 'public')));
‚úîÔ∏è –ò —Ä–æ—É—Ç / –º–æ–∂–Ω–æ –£–î–ê–õ–ò–¢–¨
app.get('/', ...)

Express —Å–∞–º –æ—Ç–¥–∞—Å—Ç index.html.

‚ùó 4. –£ —Ç–µ–±—è –î–í–ê –ø—Ä–æ–≥–Ω–æ–∑–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (GPT + –ª–æ–∫–∞–ª—å–Ω—ã–π)
–°–µ–π—á–∞—Å:

—Å–µ—Ä–≤–µ—Ä —Å—á–∏—Ç–∞–µ—Ç GPT-–ø—Ä–æ–≥–Ω–æ–∑

—Ñ—Ä–æ–Ω—Ç –°–ù–û–í–ê —Å—á–∏—Ç–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

‚û°Ô∏è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–∏—Ç—Å—è
‚û°Ô∏è –º–∞—Ä–∫–µ—Ä—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–≥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω–æ–µ

‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø (–ø—Ä–æ—Å—Ç–∞—è)

üëâ GPT = –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤

–ù–∞ —Ñ—Ä–æ–Ω—Ç–µ:

‚ùå –Ω–µ —Å—á–∏—Ç–∞–π calculateRainProbability –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫

‚úÖ –∏—Å–ø–æ–ª—å–∑—É–π prediction.rainChance –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

–õ–æ–∫–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –æ—Å—Ç–∞–≤—å –¢–û–õ–¨–ö–û –∫–∞–∫ fallback, –µ—Å–ª–∏ /api/predict —É–ø–∞–ª.

‚ùó 5. –¢—ã —É–±—Ä–∞–ª timestamp, –Ω–æ —Ñ—Ä–æ–Ω—Ç –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
–°–µ—Ä–≤–µ—Ä:
delete data.timestamp;
–§—Ä–æ–Ω—Ç:
formatTimestamp(data.timestamp)

‚û°Ô∏è –±—É–¥–µ—Ç undefined

‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ª—É—á—à–µ)
‚ùå –ù–ï —É–¥–∞–ª—è–π timestamp –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü—Ä–æ—Å—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–π –µ–≥–æ, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω.

–ò–õ–ò

‚úîÔ∏è –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –∑–∞—â–∏—Ç–∞:
const ts = data.timestamp ? formatTimestamp(data.timestamp) : '‚Äî';
‚ùó 6. –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ = –æ–ø–∞—Å–Ω–æ
–°–µ–π—á–∞—Å:
setInterval(updateAllData, 1000);

–ê –≤–Ω—É—Ç—Ä–∏:

/api/latest

/api/predict (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–µ—Ä–≥–∞–µ—Ç—Å—è)

‚úÖ –ò–î–ï–ê–õ–¨–ù–û
setInterval(fetchLatestData, 1000);   // Firebase
setInterval(fetchPrediction, 10000);  // GPT

–∏ –ù–ï –≤—ã–∑—ã–≤–∞—Ç—å predict –≤–Ω—É—Ç—Ä–∏ updateAllData

–≠—Ç–æ:

üí∏ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã

üöÄ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É

‚ùå —É–±–∏—Ä–∞–µ—Ç race conditions

‚ùó 7. Render REQUIREMENTS (100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ)
package.json (–ò–°–ü–û–õ–¨–ó–£–ô –¢–ê–ö)
{
  "name": "aero",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "engines": {
    "node": ">=18"
  },
  "dependencies": {
    "express": "^4.19.2",
    "dotenv": "^16.4.5",
    "openai": "^4.28.0"
  }
}

‚ùå node-fetch ‚Äî –£–ë–†–ê–¢–¨
‚ùå cors ‚Äî –Ω–µ –Ω—É–∂–µ–Ω (—Ñ—Ä–æ–Ω—Ç –∏ –±—ç–∫ –≤–º–µ—Å—Ç–µ)

‚úÖ –ß–¢–û –£ –¢–ï–ë–Ø –£–ñ–ï –°–î–ï–õ–ê–ù–û –û–ß–ï–ù–¨ –•–û–†–û–®–û

‚úî –∫–µ—à –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
‚úî fallback –µ—Å–ª–∏ GPT —É–ø–∞–ª
‚úî –∞–ª–µ—Ä—Ç—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ confidence >= 90
‚úî Leaflet + NASA GIBS
‚úî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–æ–º
‚úî –æ–¥–∏–Ω ESP ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

üî• –ò—Ç–æ–≥

–ï—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å –≠–¢–ò –ø—Ä–∞–≤–∫–∏:

Render –∑–∞–¥–µ–ø–ª–æ–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

GPT –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¥—ë—à–µ–≤–æ

UI –∏ –∫–∞—Ä—Ç–∞ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã

–ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª—å–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–ª–∏–º–ø–∏–∞–¥–Ω—ã–π / —Å—Ç–∞—Ä—Ç–∞–ø-—É—Ä–æ–≤–µ–Ω—å